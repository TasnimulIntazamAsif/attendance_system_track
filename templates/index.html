<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>Face Attendance</title>
  <link rel="stylesheet" href="/static/style.css">
</head>
<body>
<div class="wrap">
  <h2>Face Attendance</h2>

  <div class="box">
    <img src="/video_feed" alt="webcam">
  </div>

  <div class="controls">
    <button id="scan">Scan</button>
    <button id="reload">Reload Known</button>
    <label><input type="checkbox" id="auto" checked> Auto every 1.5s</label>
  </div>

  <div id="status" class="status">Ready.</div>
</div>

<script>
const statusEl = document.getElementById("status");
const auto = document.getElementById("auto");
let busy = false;

async function scanOnce(){
  if(busy) return;
  busy = true;
  try{
    const r = await fetch("/scan", {method:"POST"});
    const d = await r.json();
    statusEl.textContent = d.message || "Done";
  }catch(e){
    statusEl.textContent = "Error: " + e.message;
  }finally{
    busy = false;
  }
}

document.getElementById("scan").onclick = scanOnce;

document.getElementById("reload").onclick = async () => {
  const r = await fetch("/reload", {method:"POST"});
  const d = await r.json();
  statusEl.textContent = "Reloaded known faces: " + d.count;
};

setInterval(()=>{ if(auto.checked) scanOnce(); }, 1500);
</script>
</body>
</html>